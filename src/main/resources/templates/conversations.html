<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Conversations</title>
    <style>
        :root{--text:#1f2937;--muted:#6b7280;--bg:#f8fafc;--card:#ffffff;--line:#e5e7eb;--primary:#2563eb;--primary-weak:#dbeafe;--success:#16a34a;--warning:#d97706;--danger:#dc2626}
        *{box-sizing:border-box}
        body{font-family:Arial, sans-serif;margin:0;background:var(--bg);color:var(--text)}
        .container{max-width:1040px;margin:0 auto;padding:24px}
        .top{display:flex;gap:12px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:16px}
        h2{margin:0;font-size:22px}
        a.btn{display:inline-block;padding:8px 12px;border:1px solid var(--primary);color:var(--primary);border-radius:8px;text-decoration:none;background:var(--primary-weak)}
        .toolbar{display:flex;gap:12px;align-items:center;flex:1;justify-content:flex-end}
        .search{position:relative;min-width:240px}
        .search input{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#fff}
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
        .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:10px;transition:box-shadow .15s ease, transform .15s ease}
        .card:hover{box-shadow:0 6px 20px rgba(0,0,0,0.06);transform:translateY(-1px)}
        .title{font-weight:bold;font-size:16px;line-height:1.35}
        .meta{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px}
        .badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid var(--line);background:#fff}
        .badge .dot{width:8px;height:8px;border-radius:50%}
        .badge.active{border-color:#a7f3d0;background:#ecfdf5}
        .badge.active .dot{background:var(--success)}
        .badge.pending{border-color:#fde68a;background:#fffbeb}
        .badge.pending .dot{background:var(--warning)}
        .badge.closed{border-color:#fecaca;background:#fef2f2}
        .badge.closed .dot{background:var(--danger)}
        .actions{display:flex;gap:8px}
        .link{padding:6px 10px;border:1px solid var(--line);border-radius:8px;text-decoration:none;color:var(--text);background:#fff}
        .link.primary{border-color:var(--primary);color:#fff;background:var(--primary)}
        .empty{border:1px dashed var(--line);border-radius:12px;padding:24px;text-align:center;color:var(--muted);background:#fff}
        
        /* User profile styles */
        .user-profile{display:flex;align-items:center;gap:12px;padding:12px 16px;background:var(--card);border:1px solid var(--line);border-radius:12px;margin-bottom:16px}
        .avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg, #667eea, #764ba2);display:flex;align-items:center;justify-content:center;color:white;font-weight:bold;font-size:16px;flex-shrink:0}
        .user-info{flex:1;display:flex;flex-direction:column;gap:2px}
        .user-name{font-weight:600;font-size:16px;color:var(--text)}
        .user-role{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px}
        .logout-btn{padding:8px 16px;background:#dc2626;color:white;border:none;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;transition:all 0.2s ease;text-decoration:none;display:inline-block}
        .logout-btn:hover{background:#b91c1c;transform:translateY(-1px)}
        .staff-badge{background:linear-gradient(135deg, #f59e0b, #d97706);color:white;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
        .admin-badge{background:linear-gradient(135deg, #dc2626, #b91c1c);color:white;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px}
    </style>
    </head>
<body>
<div class="container">
  <!-- User Profile Section -->
  <div class="user-profile" th:if="${currentUser}">
    <div class="avatar" th:text="${#strings.substring(currentUser.displayName, 0, 1)}">U</div>
    <div class="user-info">
      <div class="user-name" th:text="${currentUser.displayName}">User Name</div>
      <div class="user-role">
        <span th:if="${session.isAdmin != null and session.isAdmin}" class="admin-badge">Admin</span>
        <span th:if="${session.isStaff != null and session.isStaff and (session.isAdmin == null or !session.isAdmin)}" class="staff-badge">Staff</span>
        <span th:if="${(session.isStaff == null or !session.isStaff) and (session.isAdmin == null or !session.isAdmin)}">User</span>
      </div>
    </div>
    <a th:href="@{/logout-simple}" class="logout-btn">Đăng xuất</a>
  </div>

  <div class="top">
    <h2>Conversations</h2>
    <div class="toolbar">
      <div class="search">
        <input id="search" type="text" placeholder="Tìm theo tiêu đề hoặc trạng thái..." autocomplete="off" />
      </div>
      <a class="btn" th:href="@{/conversations/new}" th:if="${(session.isStaff == null or !session.isStaff) and (session.isAdmin == null or !session.isAdmin)}">New conversation</a>
    </div>
  </div>

  <div class="empty" th:if="${conversations} == null or ${#lists.isEmpty(conversations)}">
    Chưa có cuộc hội thoại nào.
  </div>

  <div id="cards" class="grid" th:if="${conversations} != null and !${#lists.isEmpty(conversations)}">
    <div class="card" th:each="c: ${conversations}"
         th:attr="data-title=${#strings.toLowerCase(c.title)},data-status=${#strings.toLowerCase(c.status)}">
      <div class="title" th:text="${c.title}">Title</div>
      <div class="meta">
        <div th:class="${'badge ' + #strings.toLowerCase(c.status)}">
          <span class="dot"></span>
          <span th:text="${c.status}">active</span>
        </div>
        <div th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">time</div>
      </div>
      <div class="actions">
        <a class="link" th:href="@{'/chat/' + ${c.id}}">Open</a>
        <a class="link primary" th:href="@{'/chat/' + ${c.id}}">Chat</a>
      </div>
    </div>
  </div>
</div>

<script>
  (function(){
    var input = document.getElementById('search');
    var list = document.getElementById('cards');
    if (!input || !list) return;
    function normalize(s){ return (s||'').toString().trim().toLowerCase(); }
    function apply(){
      var q = normalize(input.value);
      var items = list.children;
      for (var i=0;i<items.length;i++){
        var el = items[i];
        var t = el.getAttribute('data-title') || '';
        var st = el.getAttribute('data-status') || '';
        var show = !q || t.indexOf(q) > -1 || st.indexOf(q) > -1;
        el.style.display = show ? '' : 'none';
      }
    }
    input.addEventListener('input', apply);
  })();
</script>
</body>
</html>


